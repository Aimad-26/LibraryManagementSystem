syntax = "proto3";

package library_system;

// --- 1. Authentication Messages ---

message LoginRequest {
Â  string username = 1;
Â  string password = 2;
}

message LoginResponse {
Â  bool success = 1;
Â  string user_id = 2; // Staff ID (Django User ID) returned on successful login
Â  string message = 3;Â 
}

// --- 2. Inventory Messages ---

message Book {
Â  int32 id = 1;
Â  string title = 2;
Â  string author = 3;
Â  string isbn = 4;
Â  
  // ğŸš€ UPDATED: Stock Quantity Fields (Replaced bool is_available) ğŸš€
Â  int32 total_copies = 5;
Â  int32 available_copies = 6;
  
  // ğŸš€ NEW: Field for the file path/URL ğŸš€
  string image_url = 7; 
}

message SearchRequest {
Â  string query = 1; // Used for search keywords in the dashboard
}

// --- 3. Transaction Messages ---

// Standard response used for confirmation, creation, or update status
message StatusResponse {
Â  bool success = 1;
Â  string message = 2;
Â  int32 entity_id = 3; // The ID of the item affected (Book ID, Loan ID, etc.)
}

// Request needed for loan transactions
message BorrowRequest {
Â  string member_id = 1;Â  // The ID of the LibraryUser (Patron)
Â  int32 book_id = 2;Â  Â  Â // The ID of the Book being borrowed/returned
}

// --- 4. Profile Update Message (Librarian/Staff) ---

message UpdateProfileRequest {
Â  string staff_id = 1;Â  Â  Â  Â // Unique ID of the staff member making the request
Â  string new_username = 2;
Â  string new_email = 3;
Â  string current_password = 4; // Required for security verification
Â  string new_password = 5;Â  Â  Â // Optional, for password change
}

// ----------------------------------------------------
// SERVICE DEFINITION: LibraryService (The RPC API)
// ----------------------------------------------------

service LibraryService {
Â  // Authentication
Â  rpc UserLogin (LoginRequest) returns (LoginResponse) {}Â 
Â Â 
Â  // Inventory Management (Implemented: CreateBook, SearchBooks)
Â  rpc CreateBook (Book) returns (StatusResponse) {}
Â  rpc SearchBooks (SearchRequest) returns (stream Book) {}
Â  // âš ï¸ NOTE: GetBook and UpdateBookAvailability RPCs may need review, 
  // as they rely on the old Book structure (if you use them).
Â  rpc GetBook (SearchRequest) returns (Book) {} 
Â  rpc UpdateBookAvailability (Book) returns (StatusResponse) {}

Â  // Loan Management (Next steps)
Â  rpc BorrowBook (BorrowRequest) returns (StatusResponse) {}
Â  rpc ReturnBook (BorrowRequest) returns (StatusResponse) {}
Â Â 
Â  // Staff Management (Implemented for Profile Update)
Â  rpc UpdateStaffProfile (UpdateProfileRequest) returns (StatusResponse) {}
}